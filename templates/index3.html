<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gemini AI - Text & Voice Prompt</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-2xl">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">✨ Gemini AI (Text + Voice Input)</h1>
    
    <form method="POST" class="flex flex-col gap-4">
      <div class="flex gap-2">
        <input id="prompt" type="text" name="prompt" placeholder="Speak or type your question..." required
               class="border rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <button type="button" id="micBtn"
                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
          🎤
        </button>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
        Generate
      </button>
    </form>

    {% if response %}
    <div class="mt-6 p-4 border rounded-lg bg-gray-50">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">Result for:</h2>
      <p class="text-blue-600 italic">"{{ prompt }}"</p>
      <div class="mt-3 text-gray-900 prose max-w-none">
        {{ response|safe }}
      </div>
    </div>
    {% endif %}
  </div>

  <script>
    const micBtn = document.getElementById("micBtn");
    const promptInput = document.getElementById("prompt");

    // Web Speech API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = false;

      micBtn.addEventListener("click", () => {
        recognition.start();
        micBtn.textContent = "🎙️ Listening...";
      });

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        promptInput.value = transcript;
        micBtn.textContent = "🎤";
      };

      recognition.onerror = () => {
        micBtn.textContent = "🎤";
        alert("Speech recognition error. Try again.");
      };

      recognition.onend = () => {
        micBtn.textContent = "🎤";
      };
    } else {
      micBtn.disabled = true;
      micBtn.textContent = "🚫";
      alert("Your browser does not support speech recognition.");
    }
  </script>
</body>
</html>
